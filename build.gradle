group 'RLBot'
version '1.0-SNAPSHOT'


def apiFile = new File('apikey')
def apikey = ''
if (apiFile.exists()) {
    apikey = apiFile.text
}

buildscript {
    repositories {
        jcenter()
    }
    dependencies {
    }
}

apply plugin: 'java'

repositories {
    jcenter()
}

dependencies {
    compile 'rlbotofficial.RLBotProtoMaven:proto-interface:0.0.2:game_data@py'
    compile 'rlbotofficial.RLBotProtoMaven:proto-interface:0.0.2'
}

task assembleProto(type: Copy) {
    from findFile('game_data.py')
    into 'protobuf'
    rename { String file ->
        'game_data_pb2.py'
    }
}

clean {
    delete fileTree('protobuf') {
        include '**/*pb2.py'
    }
}

def findFile(suffix) {
    configurations.compile.filter { it.name.endsWith(suffix) }
}

task pipInstallRequirements(type: Exec) {
    commandLine "pip", "install", "-r", "requirements.txt"
}

task run(type: Exec) {
    commandLine "python", "runner.py"
}

run.dependsOn build
processResources.dependsOn pipInstallRequirements
processResources.dependsOn assembleProto


bintray {
    user = 'rlbotofficial'
    key = apikey
    pkg {
        repo = 'RLBot'
        name = 'framework'
        licenses = ['MIT']
        vcsUrl = 'https://github.com/RLBot/RLBotProtobuf.git'
        version {
            name = '0.0.1-Initial'
            released = new Date()
            vcsTag = '0.0.1'
        }
    }
    filesSpec {
        from('.') {
            include '*.py'
        }
        from 'RLBotFramework'
        into 'RLBotFramework'
    }
}

